<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="/jquery.js" type="application/javascript"></script>
    <link type="text/css" rel="styleSheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"/>
</head>

<script tpye="application/javascript">

function getSeries(){

    //AJAX

    $.ajax( { url : '/series' } )
    .done(rellenarTablaSeries)
    .fail(procesarError)

}



function seleccionarSerie(_id){
 
    //Podemos guardar en una cookie el valor del _id seleccionado y acceder a él
    //en la siguiente 'pantalla'

    //Tambien podemos utilizar el sessionStorage
    //sessionStorage.setItem("_id_serie", _id)
    //window.location = "formularioSeries.html"

    //Otra opción es pasar el valor por la url
    window.location = "formularioSeries.html?_id="+_id

}

function rellenarTablaSeries(series){

    console.log(series)

    $(series).each(function(pos, serie){
        //console.log(this == serie) //True
        $(`<tr style="cursor: pointer;">
                <td>${serie.titulo}</td>
                <td>${serie.genero}</td>
                <td>${serie.year}</td>
                <td>${serie.pais}</td>
           </tr>`)
           .click(function(){
                //CUIDADO QUE ESTE THIS ES DE ESTA FUNCIÓN!
                //console.log(this == serie) //FALSE
                //seleccionarSerie(this._id)
                seleccionarSerie(serie._id)
           })
           .appendTo("#tablaSeries")
    })

}

function procesarError(error){
    console.log(error)
}

function verFormularioSeries(){

    //Con todo
    //window.location = 'http://localhost:6001/formularioSeries.html'
    //Con ruta absoluta
    //window.location = '/formularioSeries.html'
    //Con ruta relativa
    //window.location = './formularioSeries.html'
    //No hace falta que la ruta relativa comience por ./
    window.location = 'formularioSeries.html'

    //Tambien funciona con
    //document.location
    //Y la clásica
    //document.location.href
}


$(inicializar)

function inicializar(){
    console.log("Inicializando...")

    //poner los eventooooooooooos...
    $("#btnNueva").click(verFormularioSeries)

    getSeries()

}

</script>

<body>
    
    <div class="jumbotron">
        <marquee>
            <h1>SeriesGest 3000</h1>
        </marquee>
    </div>

    <div class="text-center mt-4 mb-4">
        <button class="btn btn-primary" id="btnNueva">Nueva</button>
    </div>

    <!--
    .col-    (extra small devices - screen width less than 576px)
    .col-sm- (small devices - screen width equal to or greater than 576px)
    .col-md- (medium devices - screen width equal to or greater than 768px)
    .col-lg- (large devices - screen width equal to or greater than 992px)
    .col-xl- (xlarge devices - screen width equal to or greater than 1200px)
    -->    

    <div class="row">

        <div class="col-sm-0 col-lg-2"></div>

        <div class="col-sm-12 col-lg-8">

            <table class="table table-striped table-hover ">
                <thead>
                  <tr>
                    <th>Titulo</th>
                    <th>Genero</th>
                    <th>Año</th>
                    <th>Pais</th>
                  </tr>
                </thead>
                <tbody id="tablaSeries"></tbody>
            </table>

        </div>

    </div>

</body>
</html>