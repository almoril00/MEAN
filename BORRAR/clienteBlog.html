<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<script src="https://s3.amazonaws.com/stitch-sdks/js/bundles/4/stitch.js"></script>

<script type="application/javascript">

  // Initialize the App Client
  const client = stitch.Stitch.initializeDefaultAppClient("blogtutorial-elfuh");
  // Get a MongoDB Service Client
  const mongodb = client.getServiceClient(
    stitch.RemoteMongoClient.factory,
    "mongodb-atlas"
  );
  // Get a reference to the blog database
  const db = mongodb.db("blog");    


  function displayComments() {
  db.collection("comments")
    .find({}, {limit: 1000})
    .toArray()
    .then(docs => {
      const html = docs.map(doc => `<div>${doc.comment}</div>`);
      document.getElementById("comments").innerHTML = html;
    });
}  

function addComment() {
  const newComment = document.getElementById("new_comment");
  console.log("add comment", client.auth.user.id)
  db.collection("comments")
    .insertOne({ owner_id : client.auth.user.id, comment: newComment.value })
    .then(displayComments);
  newComment.value = "";
}

window.onload = function(){
    client.auth
    .loginWithCredential(new stitch.AnonymousCredential())
    .then(displayComments)
    .catch(console.error);
}

</script>


<body>
    
<div id="comments"></div>

<hr>
Add comment:
<input id="new_comment"><input type="submit" onClick="addComment()">

</body>
</html>